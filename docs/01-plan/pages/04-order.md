# 주문 페이지 기획서

> PDF p.8~11 기반

---

## 개요

- **경로**: `/order`, `/order/:id`, `/order/:id/refund`
- **메뉴**: 사이드바 4번
- **목적**: 주문 목록 조회 및 환불 거래 생성
- **로그인 후 기본 이동 페이지**

---

## 페이지 목록

| 경로 | 페이지명 | 설명 |
|------|---------|------|
| `/order` | 주문 목록 | 전체 주문 목록 조회 |
| `/order/:id` | 주문 상세 | 주문 상세 정보 조회 + 환불 버튼 |
| `/order/:id/refund` | 환불 거래 생성 | 환불 거래 생성 폼 |

---

## 1. 주문 목록

### 화면 구성

```
┌─────────────────────────────────────────────────────────────────┐
│ 주문                                                            │  ← PageHeader
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 상태 [전체 V]     주문id [______]     [거래id V] [______]     │ │  ← SearchFilter
│ │ 상품id [______]   유저id [______]                            │ │
│ │ 거래일시 [📅____~____] [오늘][어제][이번달][지난달]            │ │
│ │                                           [초기화] [검색]   │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│                                           [엑셀 다운로드]         │  ← 액션 버튼 영역
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │주문ID│상태│상품ID│상품명│유저ID│결제수단│결제금액│거래요청│거래처리│ │  ← Table
│ ├────┼───┼────┼────┼────┼─────┼─────┼─────┼─────┤ │
│ │12345│결제완료│2222│아이스아메리카노│K11462│카드│4,500│12.13 13:22│12.13 13:22│ │
│ │12346│환불완료│2223│빅맥세트│K11463│카드│8,900│12.14 10:00│12.14 10:05│ │
│ │12347│결제취소│2224│영화관람권│K11464│가상계좌│12,000│12.15 09:30│12.15 09:30│ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│                        [페이지네이션]                            │
└─────────────────────────────────────────────────────────────────┘
```

### 검색 필터

| 필드명 | 컴포넌트 | 옵션/플레이스홀더 | 검색 방식 |
|--------|----------|------------------|----------|
| 상태 | Select | 전체 / 대기 / 결제완료 / 결제취소 / 환불완료 | exact |
| 주문id | Input | "주문id" | exact |
| 거래id 타입 | Select | 거래id / PG사 거래번호 / 기프티쇼 거래번호 | - |
| 거래id 값 | Input | (선택된 타입에 따라 변경) | exact |
| 상품id | Input | "상품id" | exact |
| 유저id | Input | "유저id" | exact |
| 거래일시 | DateRangePicker | 시작일 ~ 종료일 + 퀵버튼 | **거래처리일 기준** 범위 |

### 거래일시 퀵버튼

| 버튼 | 범위 |
|------|------|
| 오늘 | 오늘 00:00 ~ 오늘 23:59 |
| 어제 | 어제 00:00 ~ 어제 23:59 |
| 이번달 | 이번달 1일 ~ 오늘 |
| 지난달 | 지난달 1일 ~ 지난달 말일 |

### 액션 버튼

| 버튼명 | Variant | 동작 |
|--------|---------|------|
| 엑셀 다운로드 | secondary | 목록 엑셀 다운로드 |

### 테이블 정의

| 컬럼명 | 필드 | 타입 | 너비 | 정렬 |
|--------|------|------|------|------|
| 주문ID | id | number | 80px | left |
| 상태 | status | Badge | 80px | left |
| 상품ID | productId | number | 80px | left |
| 상품명 | productName | string | auto | left |
| 유저ID | userId | string | 80px | left |
| 결제수단 | paymentMethod | string | 80px | left |
| 결제금액 | paymentAmount | number (원) | 100px | right |
| 거래요청일시 | requestedAt | datetime | 130px | left |
| 거래처리일시 | processedAt | datetime | 130px | left |

### 상태 Badge 정의

| 상태 | Variant | 색상 |
|------|---------|------|
| 대기 | default | 회색 |
| 결제완료 | success | 초록 |
| 결제취소 | error | 빨강 |
| 환불완료 | info | 파랑 |

### 테이블 동작

- **행 클릭**: `/order/:id`로 이동 (주문 상세)
- **정렬**: 최신 주문ID순 (내림차순)
- **페이지네이션**: 20개씩

---

## 2. 주문 상세

### 화면 구성 (결제완료 상태)

```
┌─────────────────────────────────────────────────────────────────┐
│ [← 목록으로]  주문 상세  [12345]                                  │  ← PageHeader + ID Badge
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │   상태              거래 ID                                  │ │
│ │  [결제완료]          2222                                    │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 주문 고객 정보                                               │ │  ← Card + InfoTable
│ │ ┌───────────┬───────────┬────────────────┬──────────────┐  │ │
│ │ │ 고객id     │ 고객명     │ 이메일          │ 전화번호      │  │ │
│ │ │ 45678     │ 김고객     │ abc@nate.com   │ 010-0000-0000│  │ │
│ │ └───────────┴───────────┴────────────────┴──────────────┘  │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 결제정보                                                     │ │  ← Card + InfoTable
│ │ ┌────────────────────────┬────────────────────────────────┐ │ │
│ │ │ 상품ID                  │ 상품명                          │ │ │
│ │ │ 23415                   │ 아이스 아메리카노 Tall            │ │ │
│ │ ├────────────────────────┼────────────────────────────────┤ │ │
│ │ │ 거래요청일시             │ 거래 처리일시                    │ │ │
│ │ │ 2025.12.13 13:22       │ 2025.12.13 13:23               │ │ │
│ │ ├──────────────┬─────────┴────┬──────────────────────────┤ │ │
│ │ │ 결제금액      │ 비과세금액     │ 과세금액                  │ │ │
│ │ │ 4,500        │ 4,500        │ 0                        │ │ │
│ │ ├──────────────┼──────────────┼──────────────────────────┤ │ │
│ │ │ 거래수단      │ PG사 거래번호  │ kt알파 거래번호           │ │ │
│ │ │ 카드         │ xxxxxx       │ yyyyyyy                  │ │ │
│ │ └──────────────┴──────────────┴──────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 수신자 정보                                                  │ │  ← Card + InfoTable
│ │ ┌───────────┬───────────┬────────────────┬──────────────┐  │ │
│ │ │ 고객id     │ 고객명     │ 이메일          │ 전화번호      │  │ │
│ │ │ 44565     │ 이수신     │ def@nate.com   │ 010-1111-1111│  │ │
│ │ └───────────┴───────────┴────────────────┴──────────────┘  │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│                                              [환불하기]          │  ← 결제완료 상태일 때만
└─────────────────────────────────────────────────────────────────┘
```

### 화면 구성 (환불완료 상태)

```
┌─────────────────────────────────────────────────────────────────┐
│ [← 목록으로]  주문 상세  [12345]                                  │  ← PageHeader + ID Badge
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │   상태              거래 ID           환불거래 ID             │ │
│ │  [환불완료]          2222              2244                  │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ (주문 고객 정보, 결제정보, 수신자 정보 - 동일)                       │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 환불 정보                                                    │ │  ← Card + InfoTable (추가)
│ │ ┌───────────┬───────────────┬───────────────┬─────────────┐ │ │
│ │ │ 환불금액   │ 거래요청일시    │ 거래 처리일시   │ 환불사유     │ │ │
│ │ │ -4,500    │ 2025.12.16 12:22│ 2025.12.15 12:24│ 단순 변심 │ │ │
│ │ └───────────┴───────────────┴───────────────┴─────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│                                            [환불하기] (비활성화)   │
└─────────────────────────────────────────────────────────────────┘
```

### 정보 테이블 구조

#### 주문 고객 정보

| 고객id | 고객명 | 이메일 | 전화번호 |
|--------|--------|--------|----------|

#### 결제정보

| 행 | 컬럼1 | 컬럼2 | 컬럼3 |
|----|-------|-------|-------|
| 1 | 상품ID | 상품명 | |
| 2 | 거래요청일시 | 거래 처리일시 | |
| 3 | 결제금액 | 비과세금액 | 과세금액 |
| 4 | 거래수단 | PG사 거래번호 | kt알파 거래번호 |

#### 수신자 정보

| 고객id | 고객명 | 이메일 | 전화번호 |
|--------|--------|--------|----------|

#### 환불 정보 (환불완료 시에만)

| 환불금액 | 거래요청일시 | 거래 처리일시 | 환불사유 |
|----------|-------------|--------------|----------|

### 환불하기 버튼 동작

1. **표시 조건**: 거래 상태가 "결제완료"인 경우만 활성화
2. **클릭 시**:
   - `GET /coupon/check-cancellable` API 호출
   - 정상 응답 → `/order/:id/refund`로 이동
   - 비정상 응답 → alert "환불불가합니다." & 현재 화면 유지
3. **권한**: 환불하기 권한 분리 필요

---

## 3. 환불 거래 생성

### 화면 구성

```
┌─────────────────────────────────────────────────────────────────┐
│ [← 주문상세로]  환불 거래 생성                                     │  ← PageHeader
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 주문 고객 정보                                               │ │  ← Card + InfoTable (조회)
│ │ ┌───────────┬───────────┬────────────────┬──────────────┐  │ │
│ │ │ 고객id     │ 고객명     │ 이메일          │ 전화번호      │  │ │
│ │ │ 45678     │ 김고객     │ abc@nate.com   │ 010-0000-0000│  │ │
│ │ └───────────┴───────────┴────────────────┴──────────────┘  │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 환불 상품                                                    │ │  ← Card + InfoTable (조회)
│ │ ┌─────────────────────┬────────────┬────────────┐          │ │
│ │ │ 상품명               │ 결제금액    │ 결제수단    │          │ │
│ │ │ 아이스 아메리카노 Tall │ 4,500     │ 카드       │          │ │
│ │ └─────────────────────┴────────────┴────────────┘          │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 환불 사유 *                                                  │ │  ← Card + FormField
│ │ [________________________________] (20자)                   │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 가상 계좌 환불                                                │ │  ← Card (조건부)
│ │ ┌───────────────┬───────────────────┬──────────────────┐   │ │
│ │ │ 은행명         │ 계좌번호           │ 예금주명          │   │ │
│ │ │ [선택    V]    │ [________________]│ [______________] │   │ │
│ │ └───────────────┴───────────────────┴──────────────────┘   │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│                                        [취소]  [환불하기]         │
└─────────────────────────────────────────────────────────────────┘
```

### 폼 필드 정의

| 섹션 | 필드명 | 컴포넌트 | 필수 | 설명 |
|------|--------|----------|------|------|
| 주문 고객 정보 | - | InfoTable | - | 조회만 (결제거래 정보) |
| 환불 상품 | - | InfoTable | - | 조회만 (수정불가, 부분환불 불가) |
| 환불 사유 | refundReason | Input | Y | 공백포함 20자까지 |
| 가상 계좌 환불 | bankName | Select | 조건부 | 결제수단이 무통장입금/가상계좌일 때만 필수 |
| 가상 계좌 환불 | accountNumber | Input | 조건부 | 결제수단이 무통장입금/가상계좌일 때만 필수 |
| 가상 계좌 환불 | accountHolder | Input | 조건부 | 결제수단이 무통장입금/가상계좌일 때만 필수 |

### 가상 계좌 환불 섹션

- **표시 조건**: 결제수단이 "무통장입금" 또는 "가상계좌"인 경우
- **미표시/비활성화**: 그 외 결제수단 (카드 등)

### 액션 버튼

| 버튼 | 동작 |
|------|------|
| ← 주문상세로 | `/order/:id`로 이동 |
| 취소 | `/order/:id`로 이동 |
| 환불하기 | 환불 처리 (아래 참고) |

### 환불하기 버튼 동작

1. 필수값 입력 여부 체크
2. confirm "환불하시겠습니까?"
3. 확인 클릭 → 환불거래 생성 API 호출 → `/order/:id`로 이동
4. 취소 클릭 → 현재 화면 유지

---

## 데이터 모델

### 주문 (order)

```typescript
interface Order {
  id: number;                    // 주문 ID
  status: '대기' | '결제완료' | '결제취소' | '환불완료';  // 거래 상태
  productId: number;             // 상품 ID
  productName: string;           // 상품명

  // 주문 고객 정보
  customerId: string;            // 고객 ID (주문자)
  customerName: string;          // 고객명
  customerEmail: string;         // 이메일
  customerPhone: string;         // 전화번호

  // 수신자 정보
  recipientId: string;           // 수신자 ID
  recipientName: string;         // 수신자명
  recipientEmail: string;        // 이메일
  recipientPhone: string;        // 전화번호

  // 결제 정보
  transactionId: number;         // 거래 ID
  paymentMethod: string;         // 결제수단 (카드, 무통장입금, 가상계좌 등)
  paymentAmount: number;         // 결제금액
  taxFreeAmount: number;         // 비과세금액
  taxableAmount: number;         // 과세금액
  pgTransactionId: string;       // PG사 거래번호
  ktAlphaTransactionId: string;  // kt알파 거래번호

  requestedAt: string;           // 거래요청일시
  processedAt: string;           // 거래처리일시

  // 환불 정보 (환불완료 시에만)
  refundTransactionId?: number;  // 환불거래 ID
  refundAmount?: number;         // 환불금액
  refundRequestedAt?: string;    // 환불 거래요청일시
  refundProcessedAt?: string;    // 환불 거래처리일시
  refundReason?: string;         // 환불사유
}
```

---

## 거래 상태 흐름

```
[대기] ──결제성공──→ [결제완료] ──환불처리──→ [환불완료]
   │                    │
   └──결제실패/취소─────→ [결제취소]

※ 대기: 주문 완료 & 결제 전
※ 결제완료: 결제 완료
※ 결제취소: 결제 취소 또는 결제 실패
※ 환불완료: 결제 완료 후 환불 처리
```

---

## 비즈니스 규칙

1. **주문 1개에 N개의 거래**
   - 결제거래, 환불거래 등 여러 거래 가능

2. **환불**
   - 결제완료 상태에서만 환불 가능
   - 부분 환불 불가 (전액 환불만)
   - 환불 전 취소가능여부 API 체크 필수

3. **검색**
   - 주문id / 상품id / 유저id / 거래id / PG사 거래번호 / 기프티쇼 거래번호: exact 검색
   - 거래일시: 범위 검색 (거래처리일 기준)

---

## 사용 컴포넌트

- PageHeader
- SearchFilter
- Button (primary, secondary, text)
- Select
- Input
- DateRangePicker
- Table
- Badge
- Card
- InfoTable
- FormField
